<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å…¬ä¼—å·æ–‡ç« ä¸‹è½½å°åŠ©æ‰‹</title>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; background-color: #07c160; color: white; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #06ad56; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #log-area { margin-top: 20px; background: #333; color: #0f0; padding: 15px; height: 300px; overflow-y: auto; border-radius: 4px; font-family: monospace; font-size: 14px; white-space: pre-wrap; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“¦ å…¬ä¼—å·æ‰¹é‡ä¸‹è½½å™¨</h1>
    <div class="input-group">
        <label>ğŸ‘‡ ç²˜è´´ç›®å½•é¡µé“¾æ¥ (Catalog URL)</label>
        <input type="text" id="targetUrl" placeholder="ä¾‹å¦‚ï¼šhttps://mp.weixin.qq.com/s/...">
    </div>
    <button id="startBtn" onclick="startTask()">ğŸš€ å¼€å§‹æŠ“å– (Start)</button>

    <div id="log-area">ç­‰å¾…ä»»åŠ¡å¼€å§‹...</div>
</div>

<script>
    function startTask() {
        const url = document.getElementById('targetUrl').value;
        if (!url) { alert("è¯·å…ˆç²˜è´´é“¾æ¥ï¼"); return; }

        const btn = document.getElementById('startBtn');
        const logArea = document.getElementById('log-area');

        btn.disabled = true;
        btn.innerText = "â³ æ­£åœ¨è¿è¡Œä¸­...";
        logArea.innerText = ""; // æ¸…ç©ºæ—§æ—¥å¿—

        // ä½¿ç”¨ EventSource å»ºç«‹é•¿è¿æ¥ (SSE)
        const eventSource = new EventSource('/api/start?url=' + encodeURIComponent(url));

        // ç›‘å¬åå°å‘æ¥çš„æ¶ˆæ¯
        eventSource.onmessage = function(event) {
            // è¿½åŠ æ—¥å¿—
            logArea.innerText += event.data + "\n";
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            logArea.scrollTop = logArea.scrollHeight;

            // å¦‚æœæ”¶åˆ°ç»“æŸä¿¡å· (è™½ç„¶æˆ‘ä»¬åç«¯æ²¡å‘æ˜¾å¼çš„ closeï¼Œä½†å¯ä»¥é€šè¿‡ç‰¹å®šæ–‡å­—åˆ¤æ–­ï¼Œæˆ–è€…è¿™å°±å¤Ÿäº†)
            if (event.data.includes("å…¨éƒ¨ä»»åŠ¡å¤„ç†å®Œæˆ")) {
                eventSource.close();
                btn.disabled = false;
                btn.innerText = "ğŸš€ å¼€å§‹æŠ“å– (Start)";
            }
        };

        eventSource.onerror = function(err) {
            // SSE è¿æ¥æ–­å¼€é€šå¸¸æ„å‘³ç€ä»»åŠ¡ç»“æŸæˆ–å‡ºé”™
            console.log("Stream ended or error", err);
            eventSource.close();
            btn.disabled = false;
            btn.innerText = "ğŸš€ å¼€å§‹æŠ“å– (Start)";
        };
    }
</script>
</body>
</html>